<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Authority Before Execution - Execution Console</title>
  <meta name="description" content="Execution-time authority enforcement console. Read-only verification of the execution boundary invariant. Opik traced." />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header class="topbar" role="banner">
    <div class="topbar__left">
      <div class="brand">
        <div class="brand__name">Authority Before Execution</div>
        <div class="brand__meta">Execution Console · Read-only · proof-first</div>
      </div>
    </div>

    <div class="topbar__right">
      <a class="link" href="https://github.com/qstackfield/authority-before-execution" target="_blank" rel="noreferrer">Repository</a>
      <a class="link link--primary" href="#reproduce">Run Demo</a>
    </div>
  </header>

  <div class="shell">
    <aside class="rail" role="navigation" aria-label="Console navigation">
      <div class="rail__section">
        <div class="rail__title">Inspect</div>
        <a class="rail__item" href="#execution" data-nav>Execution</a>
        <a class="rail__item" href="#invariant" data-nav>Invariant</a>
        <a class="rail__item" href="#evidence" data-nav>Evidence</a>
        <a class="rail__item" href="#reproduce" data-nav>Reproduce</a>
        <a class="rail__item" href="#traces" data-nav>Traces</a>
      </div>

      <div class="rail__section rail__section--meta">
        <div class="rail__title">Mode</div>
        <div class="kv kv--tight">
          <div class="kv__k">Site</div>
          <div class="kv__v">Static console</div>
        </div>
        <div class="kv kv--tight">
          <div class="kv__k">Purpose</div>
          <div class="kv__v">Judge verification</div>
        </div>
        <div class="kv kv--tight">
          <div class="kv__k">Backend</div>
          <div class="kv__v">Not required</div>
        </div>
      </div>
    </aside>

    <main class="main" role="main">
      <!-- EXECUTION -->
      <section id="execution" class="panel">
        <div class="panel__head">
          <div>
            <div class="eyebrow">Execution Boundary Proof</div>
            <h1 class="h1">Execution-time authority enforcement, made legible.</h1>
            <p class="sub">
              This is a read-only console view of the system claim: enforcement happens at the execution boundary.
              No UI theater. Inspectable inputs, enforceable outcomes, and reproducible artifacts.
            </p>
          </div>

          <div class="metaCard" aria-label="Run metadata">
            <div class="metaCard__title">Run Metadata</div>
            <div class="kv">
              <div class="kv__k">Invariant ID</div>
              <div class="kv__v mono">ABE-EXEC-001</div>
            </div>
            <div class="kv">
              <div class="kv__k">Enforcement Point</div>
              <div class="kv__v mono">core/executor.py</div>
            </div>
            <div class="kv">
              <div class="kv__k">Trace Boundary</div>
              <div class="kv__v mono">execution.commit</div>
            </div>
            <div class="kv">
              <div class="kv__k">Artifact Path</div>
              <div class="kv__v mono">docs/artifacts/*.json</div>
            </div>
            <div class="metaCard__note">
              The website is static. The proof is produced when the demo is executed.
            </div>
          </div>
        </div>

        <div class="split">
          <div class="block">
            <div class="block__title">What this is</div>
            <ul class="list">
              <li><span class="tag">Enforcement</span> Execution is blocked unless authority is present, valid, in scope, and unexpired.</li>
              <li><span class="tag">Deterministic</span> The executor returns structured allow/deny results (no exceptions callers can ignore).</li>
              <li><span class="tag">Traceable</span> Opik traces capture boundary decisions at <span class="mono">execution.commit</span>.</li>
              <li><span class="tag">Verifiable</span> Each attempt can write an immutable JSON artifact (local proof).</li>
            </ul>
          </div>

          <div class="block">
            <div class="block__title">What judges should do</div>
            <ol class="steps">
              <li>Run the demo once.</li>
              <li>Verify the four outcomes: missing, valid, out-of-scope, expired.</li>
              <li>Inspect the artifacts in <span class="mono">docs/artifacts/</span> on the machine that ran the demo.</li>
              <li>Confirm traces exist for <span class="mono">execution.commit</span> in Opik.</li>
            </ol>
            <div class="note">
              No “mock data service” is required. Enforcement and tracing occur at runtime.
            </div>
          </div>
        </div>

        <div class="console">
          <div class="console__bar">
            <div class="console__title">Execution Log (example format)</div>
            <div class="console__hint">Your actual values will reflect the run you execute.</div>
          </div>
          <pre class="console__body" aria-label="Execution log">
[RUN]
invariant_id: ABE-EXEC-001
invariant   : If explicit authority is not present, valid, and in scope at execution time, the state transition must not occur.
enforced_at : core/executor.py

[ATTEMPT 1]
decision_id : demo-deploy-001
action      : deploy_model
authority   : NONE
outcome     : BLOCKED
reason      : missing_authority

[ATTEMPT 2]
decision_id : demo-deploy-001
action      : deploy_model
authority   :
  approved_by: security-lead@company.com
  scope      : deploy_model
  expires_at : 2026-01-14T21:08:30Z
outcome     : PERMITTED

[ATTEMPT 3]
decision_id : demo-delete-001
action      : delete_model
authority scope: deploy_model
outcome     : BLOCKED
reason      : scope_violation

[ATTEMPT 4]
decision_id : demo-deploy-001
action      : deploy_model
authority   : expired
outcome     : BLOCKED
reason      : expired_authority

[VERDICT]
Invariant ABE-EXEC-001: HELD
All invalid execution attempts were blocked at the execution boundary.
          </pre>
        </div>

        <div class="callout">
          <div class="callout__title">Why this is “real” (and not UI output)</div>
          <p class="callout__p">
            The demo varies authority bindings against the same proposal and executes through the real enforcement path.
            The console output is a view on structured execution results produced by the executor, and the trace is emitted at the commit boundary.
          </p>
        </div>
      </section>

      <!-- INVARIANT -->
      <section id="invariant" class="panel">
        <div class="panel__head">
          <div>
            <div class="eyebrow">Invariant</div>
            <h2 class="h2">One rule. Enforced at one boundary.</h2>
            <p class="sub">
              If this invariant fails, the design fails. It is not advisory and it is not a scoring rubric.
            </p>
          </div>
        </div>

        <div class="invariantBox" role="region" aria-label="Invariant text">
          <div class="kv">
            <div class="kv__k">Invariant ID</div>
            <div class="kv__v mono">ABE-EXEC-001</div>
          </div>
          <div class="kv">
            <div class="kv__k">Enforced At</div>
            <div class="kv__v mono">core/executor.py</div>
          </div>

          <div class="divider"></div>

          <div class="statement">
            If explicit authority is not present, valid, and in scope at execution time, the state transition must not occur.
          </div>

          <div class="mono statement--alt">No authority at execution time → no state change</div>

          <div class="divider"></div>

          <div class="grid3">
            <div class="miniBox">
              <div class="miniBox__k">Fail closed</div>
              <div class="miniBox__v">Missing authority deterministically blocks execution.</div>
            </div>
            <div class="miniBox">
              <div class="miniBox__k">Scope bound</div>
              <div class="miniBox__v">Authority only covers the approved action. Anything else is blocked.</div>
            </div>
            <div class="miniBox">
              <div class="miniBox__k">Time bound</div>
              <div class="miniBox__v">Authority expires. Expired approvals cannot commit state.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- EVIDENCE -->
      <section id="evidence" class="panel">
        <div class="panel__head">
          <div>
            <div class="eyebrow">Evidence</div>
            <h2 class="h2">Inputs and outputs are inspectable.</h2>
            <p class="sub">
              The website is static. The evidence is generated at demo-time and can be inspected as JSON artifacts and traces.
            </p>
          </div>
        </div>

        <div class="split">
          <div class="block">
            <div class="block__title">Decision Contract (input)</div>
            <p class="block__sub">Canonical shape of the decision object evaluated at the boundary.</p>
            <pre class="json" id="jsonDecision" aria-label="Sample decision JSON"></pre>
          </div>

          <div class="block">
            <div class="block__title">Execution Result (output)</div>
            <p class="block__sub">Canonical shape of structured allow/deny results returned by the executor.</p>
            <pre class="json" id="jsonResult" aria-label="Sample execution result JSON"></pre>
          </div>
        </div>

        <div class="block">
          <div class="block__title">Artifacts (generated at runtime)</div>
          <p class="block__sub">
            When you run the demo locally, artifacts are written on the machine that executed the run:
          </p>
          <div class="paths mono">
            docs/artifacts/demo-deploy-001.json<br />
            docs/artifacts/demo-delete-001.json
          </div>
          <div class="note">
            These files are intentionally not committed to the repo. They are runtime evidence.
          </div>
        </div>
      </section>

      <!-- REPRODUCE -->
      <section id="reproduce" class="panel">
        <div class="panel__head">
          <div>
            <div class="eyebrow">Reproduce</div>
            <h2 class="h2">Reproduce in under a minute.</h2>
            <p class="sub">
              Judges shouldn’t have to trust a narrative. They should be able to rerun enforcement and see the artifacts.
            </p>
          </div>
        </div>

        <div class="runbook">
          <div class="runbook__row">
            <div class="runbook__k">1. Run the demo</div>
            <div class="runbook__v">
              <div class="cmd">
                <code>python3 -m demo.run_demo</code>
                <button class="copy" data-copy="python3 -m demo.run_demo" aria-label="Copy demo command">Copy</button>
              </div>
            </div>
          </div>

          <div class="runbook__row">
            <div class="runbook__k">2. Inspect artifacts</div>
            <div class="runbook__v">
              <div class="cmd">
                <code>ls docs/artifacts</code>
                <button class="copy" data-copy="ls docs/artifacts" aria-label="Copy artifacts command">Copy</button>
              </div>
            </div>
          </div>

          <div class="runbook__row">
            <div class="runbook__k">3. Show the JSON proof</div>
            <div class="runbook__v">
              <div class="cmd">
                <code>sed -n '1,200p' docs/artifacts/*.json</code>
                <button class="copy" data-copy="sed -n '1,200p' docs/artifacts/*.json" aria-label="Copy JSON command">Copy</button>
              </div>
            </div>
          </div>

          <div class="runbook__row">
            <div class="runbook__k">4. Optional: comparative experiment</div>
            <div class="runbook__v">
              <div class="cmd">
                <code>python3 -m demo.experiment_compare</code>
                <button class="copy" data-copy="python3 -m demo.experiment_compare" aria-label="Copy experiment command">Copy</button>
              </div>
            </div>
          </div>
        </div>

        <div class="note">
          The demo is designed so execution outcomes differ only by authority binding.
          The proposal remains stable.
        </div>
      </section>

      <!-- TRACES -->
      <section id="traces" class="panel">
        <div class="panel__head">
          <div>
            <div class="eyebrow">Traces</div>
            <h2 class="h2">Boundary traces prove enforcement happened.</h2>
            <p class="sub">
              Tracing is not “logging.” It is proof that the execution boundary ran and emitted structured decisions.
            </p>
          </div>
        </div>

        <div class="block">
          <div class="block__title">What is traced</div>
          <ul class="list">
            <li><span class="tag">Trace name</span> <span class="mono">execution.commit</span></li>
            <li><span class="tag">Captured</span> decision snapshot + allow/deny outcome + authority context</li>
            <li><span class="tag">Why it matters</span> it proves enforcement at the commit boundary, not post-hoc narration</li>
          </ul>

          <div class="note">
            You will see the trace link printed when you run the demo (Opik session redirect).
          </div>
        </div>

        <footer class="footer">
          <div class="footer__left">
            <div class="footer__k">Repo</div>
            <a class="footer__v" href="https://github.com/qstackfield/authority-before-execution" target="_blank" rel="noreferrer">github.com/qstackfield/authority-before-execution</a>
          </div>
          <div class="footer__right">
            <div class="footer__k">Hackathon</div>
            <div class="footer__v">Encode “Commit To Change” · Best Use of Opik</div>
          </div>
        </footer>
      </section>
    </main>
  </div>

  <script>
    // Embedded canonical contract shapes (removes GitHub Pages 404s).
    // These are schema examples, not "faked metrics."
    const SAMPLE_DECISION = {
      "decision_id": "demo-deploy-001",
      "created_at": "2026-01-14T21:08:25.806376Z",
      "proposal": {
        "action": "deploy_model",
        "params": { "model": "gpt-4.1", "environment": "production" },
        "rationale": "Deploy approved model version after validation pass"
      },
      "authority": {
        "approved_by": "security-lead@company.com",
        "reason": "Change approved under incident protocol IR-2026-014",
        "scope": "deploy_model",
        "expires_at": "2026-01-14T21:08:30.867458Z"
      }
    };

    const SAMPLE_EXECUTION_RESULT = {
      "status": "blocked",
      "execution_allowed": false,
      "deny_reason": "missing_authority",
      "message": "Execution blocked: authority not bound",
      "decision_id": "demo-deploy-001",
      "action": "deploy_model",
      "authority_overbroad": false
    };

    function pretty(el, obj) {
      if (!el) return;
      el.textContent = JSON.stringify(obj, null, 2);
    }

    function setActiveNav() {
      const links = Array.from(document.querySelectorAll("[data-nav]"));
      const ids = links.map(a => a.getAttribute("href")).filter(Boolean);
      const obs = new IntersectionObserver((entries) => {
        const vis = entries.filter(e => e.isIntersecting).sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
        if (!vis) return;
        links.forEach(l => l.classList.toggle("is-active", l.getAttribute("href") === "#" + vis.target.id));
      }, { rootMargin: "-20% 0px -70% 0px", threshold: [0.1, 0.2, 0.4] });

      ids.forEach(h => {
        const el = document.querySelector(h);
        if (el) obs.observe(el);
      });
    }

    async function copyText(btn) {
      const text = btn.getAttribute("data-copy") || "";
      try {
        await navigator.clipboard.writeText(text);
        const old = btn.textContent;
        btn.textContent = "Copied";
        btn.classList.add("is-copied");
        setTimeout(() => { btn.textContent = old; btn.classList.remove("is-copied"); }, 900);
      } catch {
        // No drama. If clipboard fails, do nothing.
      }
    }

    function bindCopyButtons() {
      document.querySelectorAll("button.copy").forEach(btn => {
        btn.addEventListener("click", () => copyText(btn));
      });
    }

    pretty(document.getElementById("jsonDecision"), SAMPLE_DECISION);
    pretty(document.getElementById("jsonResult"), SAMPLE_EXECUTION_RESULT);
    setActiveNav();
    bindCopyButtons();
  </script>
</body>
</html>
